<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>Redux</title>

    <meta name="description" content="Presentation">
    <meta name="author" content="Yevhen Shemet">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/serif.css" id="theme">
    <link rel="stylesheet" href="plugin/highlight/styles/zenburn.css">
    <link rel="stylesheet" href="css/overrides.css">

    <!-- Printing and PDF exports -->
    <script>
var link = document.createElement( 'link' );
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

    <!--[if lt IE 9]>
      <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="reveal">

      <div class="slides">
        <section>
          <h1>Asynchronous JavaScript</h1>
          <h3>There and Back Again</h3>
          <small>
            Created by Yevhen Shemet<br />
            github: <a href="http://github.com/yevhene/present-javascript-async">yevhene/present-javascript-async</a><br />
            heroku: <a href="http://present-javascript-async.herokuapp.com">present-javascript-async.herokuapp.com</a><br />
          </small>
        </section>

        <section>
          <h2>Concurrency</h2>

          <section>
            <h3>Multiple request handling</h3>

            <ul>
              <li>PHP (Server dependent)</li>
              <li>Java (Framework dependent)</li>
              <li>Ruby, Python (Fork)</li>
              <li>Erlang, Elixir (Out of the box)</li>
              <li>JavaScript (Async)</li>
            </ul>
          </section>
        </section>

        <section>
          <h2>Asynchronicity</h2>

          <section>
            <p>Fast controlled context switching</p>

            <img src="img/asynchronicity.svg" />
          </section>

          <section>
            <h3>Event Loop</h3>

            <pre><code class="hljs" data-trim>
while (queue.waitForMessage()){
  queue.processNextMessage();
}
            </code></pre>
          </section>

          <section>
            <h3>JavaScript is Asynchorous</h2>

            <ul>
              <li><b>In Browser</b> because it is single threaded, any code you run on that thread will automatically <b>block your UI</b></li>
              <li><b>In Node.js</b> because it is single threaded, any code you run on that thread will automatically <b>block your request handling</b></li>
            </ul>
          </section>
        </section>

        <section>
          <h2>Callbacks</h2>

          <section>
            <h3>Example</h3>


            <pre><code class="hljs" data-trim>
function userAddress(req, res) {
  User.findById(req.userId, function(err, user) {
    Address.findById(user.addressId, function(err, address) {
      var opts = { address: address };
      jade.renderFile('address.jade', opts, function (err, html) {
          res.send(html);
      });
    });
  });
}
            </code></pre>
          </section>

          <section>
            <h3>Extended example</h3>


            <pre><code class="hljs" data-trim>
function userAddress(req, res) {
  User.findById(req.userId, function(err, user) {
    Address.findById(user.addressId, function(err, address) {
      User.near(address).findAll(function(err, users) {
        Place.near(address).findAll(function(err, places) {
          var opts = {
            address: address, users: users, places: places
          };
          jade.renderFile('address.jade', opts, function (err, html) {
              res.send(html);
          });
        });
      });
    });
  });
}
            </code></pre>
          </section>

          <section>
            <h3>Pyramid of Doom</h3>

            <img src="img/pyramid-of-doom.png" />
          </section>

          <section>
            <h3>Extended example with error handling</h3>

            <pre><code class="hljs" data-trim>
function userAddress(req, res) {
  User.findById(req.userId, function(err, user) {
    if (err) {
      res.send('Error ' + err.toString());
      return;
    }

    Address.findById(user.addressId, function(err, address) {
      if (err) {
        res.send('Error ' + err.toString());
        return;
      }

      User.near(address).findAll(function(err, users) {
        if (err) {
          res.send('Error ' + err.toString());
          return;
        }

        Place.near(address).findAll(function(err, places) {
          if (err) {
            res.send('Error ' + err.toString());
            return;
          }
          var opts = {
            address: address, users: users, places: places
          };
          jade.renderFile('address.jade', opts, function (err, html) {
            if (err) {
              res.send('Error ' + err.toString());
              return;
            }
            res.send(html);
          });
        });
      });
    });
  });
}
            </code></pre>
          </section>

          <section>
            <h3>Advantages/Drawbacks</h3>

            <ul>
              <li>+ Simplicity</li>
              <li>+ Availability</li>
              <li>- Pyramid of Doom</li>
              <li>- Error handling</li>
            </ul>
          </section>
        </section>

        <section>
          <h2>Promises</h2>

          <section>
            <h3>Definition</h3>

            <p>The <b>Promise</b> object is used for asynchronous computations. A <b>Promise</b> represents a value which may be available now, or in the future, or never.</p>

            <pre><code class="hljs" data-trim>
new Promise( /* executor */ function(resolve, reject) { ... } );
            </code></pre>
          </section>

          <section>
            <h3>Example</h3>

            <pre><code class="hljs" data-trim>
function userAddress(req, res) {
  User
    .findById(req.userId)
    .then(user => Address.findById(user.addressId))
    .then(address => Promise.all([
      Promise.resolve(address),
      User.near(address).findAll(),
      Place.near(address).findAll()
    ]))
    .then(results =>
      jade.renderFile('address.jade', {
        address: results[0], users: results[1], places: results[2]
      })
    )
    .then(html => res.send(html))
    .catch(err => res.send('Error' + err.toString()))
}
            </code></pre>
          </section>

          <section>
            <h3>Wrapping callback</h3>

            <pre><code class="hljs" data-trim>
function renderFile(file, opts) {
  return new Promise(function (resolve, reject) {
    jade.renderFile(file, opts, function(err, html) {
      if (err) {
        reject(err);
        return;
      }

      resolve(html);
    });
  });
}
            </code></pre>

            <small>or</small>

            <pre><code class="hljs" data-trim>
var renderFile = promissify(jade.renderFile);
            </code></pre>
          </section>

          <section>
            <h3>Advantages/Drawbacks</h3>

            <ul>
              <li>+ No Pyramid of Doom</li>
              <li>+ Smple Error handling</li>
              <li>+ Execution trees</li>
            </ul>
          </section>
        </section>

        <section>
          <h2>Generators</h2>

          <p>TODO</p>
        </section>

        <section>
          <h2>Async/Await</h2>

          <p>TODO</p>
        </section>

        <section>
          <p>How to use it now?</p>

          <p>TODO</p>
        </section>

        <section>
          <p>Credits</p>

          <p>TODO</p>
        </section>

        <section>
          <h2>Thanks</h2>
        </section>
      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>
      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,
        transition: 'slide', // none/fade/slide/convex/concave/zoom
        // Optional reveal.js plugins
        dependencies: [
        { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
        { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
        { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
        { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
        { src: 'plugin/zoom-js/zoom.js', async: true },
        { src: 'plugin/notes/notes.js', async: true }
        ]
      });
    </script>
  </body>
</html>
